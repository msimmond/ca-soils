|                                                   |                                                   |                                                   |
|:-------------------------------------------------:|:-------------------------------------------------:|:-------------------------------------------------:|
| ![More is better](https://raw.githack.com/WA-Department-of-Agriculture/soils/main/figures/curve-more.png){width=1.2in} | ![Optimal range](https://raw.githack.com/WA-Department-of-Agriculture/soils/main/figures/curve-optimal.png){width=1.2in} | ![Less is better](https://raw.githack.com/WA-Department-of-Agriculture/soils/main/figures/curve-less.png){width=1.2in} |


```{r}
# Load all indicators
all_indicators <- read.csv(
  "inst/extdata/indicators.csv",
  check.names = FALSE,
  encoding = "UTF-8",
  strip.white = TRUE
)

# Create mapping from display names to column names
indicator_mapping <- list(
  "Water Stable Aggregates" = "water_stable_aggregates_pct",
  "Aggregate Stability Index" = "agg_stability_slakes", 
  "Infiltration (1st inch)" = "infil1_sec",
  "Infiltration (2nd inch)" = "infil2_sec",
  "pH" = "ph",
  "CEC" = "cec_meq_100g",
  "P" = "p_ppm",
  "K" = "k_ppm",
  "Ca" = "ca_ppm",
  "Mg" = "mg_ppm",
  "Total N" = "n_pct",
  "PMN - 28 days" = "pmn_t28",
  "NO3-N" = "no3",
  "Nitrate Quick Test" = "nitrate_quick",
  "Total C" = "c_pct",
  "Organic Matter" = "om_pct",
  "CO2 Resp." = "co2_resp_24",
  "POXC" = "poxc_ppm",
  "Microbial Biomass" = "microbial_biomass",
  "Bacterial Biomass" = "bacterial_biomass",
  "Fungal Biomass" = "fungal_biomass",
  "AMF Biomass" = "amf_biomass",
  "Fungi:Bacteria" = "fungi_bacteria_ratio",
  "Protozoan Biomass" = "protozoa_biomass",
  "Undifferentiated Biomass" = "undiff_biomass",
  "Biopore Count" = "biopore_count",
  "Visible Invert. Count" = "biodiversity_count"
)

# Filter indicators to only show selected ones
if (!is.null(params$selected_indicators) && length(params$selected_indicators) > 0) {
  # Convert selected column names to display names
  selected_display_names <- names(indicator_mapping)[indicator_mapping %in% params$selected_indicators]
  
  # Filter the indicators table
  indicators <- all_indicators[all_indicators[["Soil Health Indicator"]] %in% selected_display_names, ]
} else {
  # If no selection, show all indicators
  indicators <- all_indicators
}
```

```{r}
flextable::flextable(indicators) |>
casoils::style_ft(
  header_font = header_font,
  body_font = body_font,
  header_color = header_color,
  header_text_color = header_text_color,
  border_color = border_color
) |>
flextable::set_table_properties(layout = "autofit")

```
